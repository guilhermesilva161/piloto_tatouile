<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Funcionários</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <style>
    body {
      font-family: ui-monospace, SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
    }
  </style>
</head>
<body class="bg-[#04103a] min-h-screen flex flex-col p-4 sm:p-6 md:p-8">
  <header class="flex items-center space-x-2 mb-4">
    <button aria-label="Voltar" class="text-[#0a1e5e] bg-[#0a1e5e] rounded-md p-1.5 text-xl leading-none hover:bg-[#0f2a8a] transition-colors" id="back-to-list" style="display:none">
      <i class="fas fa-arrow-left text-white"></i>
    </button>
    <nav class="flex items-center space-x-2" id="nav-buttons">
      <button aria-label="Voltar à página anterior" onclick="history.back()" class="text-white text-lg hover:text-[#3a6fff] transition-colors">
        <i class="fas fa-arrow-left"></i>
      </button>
      <button class="bg-[#0a1e5e] text-white rounded-md px-4 py-1.5 font-semibold text-sm leading-none hover:bg-[#0f2a8a] transition-colors">
        Receitas
      </button>
      <button class="bg-[#0a1e5e] text-white rounded-md px-4 py-1.5 font-semibold text-sm leading-none hover:bg-[#0f2a8a] transition-colors">
        Categorias
      </button>
      <button class="bg-transparent border border-[#3a6fff] text-white rounded-md px-4 py-1.5 font-semibold text-sm leading-none">
        Funcionários
      </button>
      <button onclick="window.location.href='cargo.html'" class="bg-[#0a1e5e] text-white rounded-md px-4 py-1.5 font-semibold text-sm leading-none hover:bg-[#0f2a8a] transition-colors">
        Cargos
      </button>
    </nav>
  </header>

  <main class="flex flex-col sm:flex-row gap-6" id="main-content">
    <section class="text-white text-sm leading-relaxed max-w-xs sm:max-w-sm" id="list-section">
      <p class="mb-2">Funcionários:</p>
      <input type="text" id="search" placeholder="Pesquisar" class="mb-4 bg-[#134a8e] text-white rounded text-center py-1 w-full" />
      <ul id="funcionario-list" class="border border-[#1a2a5e] p-4 space-y-1 max-w-xs sm:max-w-sm" style="font-family: ui-monospace, SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;">
        <!-- Funcionários serão inseridos aqui via JS -->
      </ul>
    </section>

    <section id="popup" aria-label="Pop-up de confirmação de exclusão" class="hidden bg-white text-[#0a1e5e] text-xs rounded-md p-3 w-28 h-16 flex flex-col justify-center items-center font-sans fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 shadow-lg z-50">
      <p class="text-center mb-1 font-semibold">Pop-up</p>
      <p class="text-center mb-2">Deseja excluir?</p>
      <div class="flex justify-between w-full px-4 text-xs font-normal">
        <button id="confirm-delete" class="hover:underline">Sim</button>
        <button id="cancel-delete" class="hover:underline">Não</button>
      </div>
    </section>

    <div id="overlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>
  </main>

  <button id="add-funcionario-btn" aria-label="Adicionar" class="fixed bottom-6 right-6 bg-white text-[#0a1e5e] rounded-md w-10 h-10 flex justify-center items-center text-2xl font-bold shadow-md hover:bg-[#e5e5e5] transition-colors z-30">
    +
  </button>

  <!-- New Add/Edit/View Funcionário Page -->
  <section id="add-funcionario-page" class="hidden flex flex-col items-center bg-[#000c2d] min-h-screen p-6">
    <header class="w-full max-w-xs flex items-center bg-[#134a8e] h-10 rounded-b-md relative mb-6">
      <button aria-label="Voltar" id="back-from-add" class="text-white text-lg pl-2 flex items-center justify-center w-10 h-10">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="absolute left-1/2 -translate-x-1/2 top-1 rounded-md border border-white bg-[#134a8e] text-white text-sm font-semibold px-4 py-[2px]">
        Funcionários
      </div>
    </header>

    <main class="w-full max-w-xs flex flex-col items-center space-y-4">
      <button id="add-edit-title" class="bg-[#00031a] text-white text-xs font-semibold rounded px-4 py-1" type="button" disabled>
        Adicionar Funcionário
      </button>

      <img id="funcionario-view-image" class="w-32 h-32 object-cover rounded-full border-2 border-white mb-2 hidden" alt="Imagem do Funcionário" />


      <div id="campo-imagem" class="w-full">
  <label for="funcionario-image" class="block bg-[#134a8e] text-white text-xs font-semibold rounded text-center py-1">Imagem:</label>
  <input id="funcionario-image" type="file" accept="image/jpeg, image/png"
         class="w-full max-w-xs rounded border-0 bg-[#134a8e] text-white text-xs font-semibold text-center py-1" />
</div>


      <div id="campo-matricula" class="w-full">
  <label for="funcionario-matricula" class="block bg-[#134a8e] text-white text-xs font-semibold rounded text-center py-1">Matricula:</label>
  <input id="funcionario-matricula" type="text" class="w-full max-w-xs rounded border-0 bg-[#134a8e] text-white text-xs font-semibold text-center py-1" autocomplete="off" />
  <div id="matricula-visualizacao" class="hidden bg-[#134a8e] text-white text-xs font-semibold text-center py-1 rounded"></div>
</div>

      <div id="campo-nome" class="w-full">
  <label for="funcionario-name" class="block bg-[#134a8e] text-white text-xs font-semibold rounded text-center py-1">Nome:</label>
  <input id="funcionario-name" type="text" class="w-full max-w-xs rounded border-0 bg-[#134a8e] text-white text-xs font-semibold text-center py-1" autocomplete="off" />
  <div id="nome-visualizacao" class="hidden bg-[#134a8e] text-white text-xs font-semibold text-center py-1 rounded"></div>
</div>

 <div id="campo-rg" class="w-full">
  <label for="funcionario-rg" class="block bg-[#134a8e] text-white text-xs font-semibold rounded text-center py-1">RG:</label>
  <input id="funcionario-rg" type="text" class="w-full max-w-xs rounded border-0 bg-[#134a8e] text-white text-xs font-semibold text-center py-1" autocomplete="off" />
  <div id="rg-visualizacao" class="hidden bg-[#134a8e] text-white text-xs font-semibold text-center py-1 rounded"></div>
</div>


      <div id="campo-data-ingresso" class="w-full">
  <label for="funcionario-data-ingresso" class="block bg-[#134a8e] text-white text-xs font-semibold rounded text-center py-1">Data-ingresso:</label>
  <input id="funcionario-data-ingresso" type="text" class="w-full max-w-xs rounded border-0 bg-[#134a8e] text-white text-xs font-semibold text-center py-1" autocomplete="off" />
  <div id="data-ingresso-visualizacao" class="hidden bg-[#134a8e] text-white text-xs font-semibold text-center py-1 rounded"></div>
</div>

      <div id="campo-cargo" class="w-full">
  <label for="funcionario-cargo" class="block bg-[#134a8e] text-white text-xs font-semibold rounded text-center py-1">Cargo:</label>
  <select id="funcionario-cargo" class="w-full max-w-xs rounded border-0 bg-[#134a8e] text-white text-xs font-semibold text-center py-1">
    <!-- Cargos serão inseridos aqui via JS -->
  </select>
  <div id="cargo-visualizacao" class="hidden bg-[#134a8e] text-white text-xs font-semibold text-center py-1 rounded"></div>
</div>


       <div id="campo-salario" class="w-full">
  <label for="funcionario-salario" class="block bg-[#134a8e] text-white text-xs font-semibold rounded text-center py-1">Salario:</label>
  <input id="funcionario-salario" type="text" class="w-full max-w-xs rounded border-0 bg-[#134a8e] text-white text-xs font-semibold text-center py-1" autocomplete="off" />
  <div id="salario-visualizacao" class="hidden bg-[#134a8e] text-white text-xs font-semibold text-center py-1 rounded"></div>
</div>
     

      <button id="save-funcionario-btn" class="bg-white text-black text-xs font-bold rounded px-3 py-1 self-end" type="button">
        SALVAR
      </button>
    </main>
  </section>

  <script>
    const funcionarios = [];
    const cargos = [
      { nome: "Administrador" },
      { nome: "Analista de Sistemas" },
      { nome: "Chefe" },
      { nome: "Degustador" },
      { nome: "Editor" },
      { nome: "Suporte Técnico" },
    ];

    const funcionarioList = document.getElementById("funcionario-list");
    const popup = document.getElementById("popup");
    const overlay = document.getElementById("overlay");
    const confirmDeleteBtn = document.getElementById("confirm-delete");
    const cancelDeleteBtn = document.getElementById("cancel-delete");

    const addFuncionarioBtn = document.getElementById("add-funcionario-btn");
    const addFuncionarioPage = document.getElementById("add-funcionario-page");
    const mainContent = document.getElementById("main-content");
    const backToListBtn = document.getElementById("back-to-list");
    const navButtons = document.getElementById("nav-buttons");

    const backFromAddBtn = document.getElementById("back-from-add");
    const funcionarioNameInput = document.getElementById("funcionario-name");
    const funcionarioMatriculaInput = document.getElementById("funcionario-matricula");
    const funcionarioRgInput = document.getElementById("funcionario-rg");
    const funcionarioDataIngressoInput = document.getElementById("funcionario-data-ingresso");
    const funcionarioCargoSelect = document.getElementById("funcionario-cargo");
    const funcionarioSalarioInput = document.getElementById("funcionario-salario");
    const saveFuncionarioBtn = document.getElementById("save-funcionario-btn");
    const addEditTitle = document.getElementById("add-edit-title");

    let funcionarioToDeleteIndex = null;

    function renderFuncionarios() {
  funcionarioList.innerHTML = "";
  funcionarios.forEach((funcionario, index) => {
    const li = document.createElement("li");
    li.className = "flex justify-between items-center space-x-2";

    const nomeSpan = document.createElement("span");
    nomeSpan.textContent = `${funcionario.nome} (${funcionario.cargo})`;
    nomeSpan.className = "cursor-pointer underline hover:text-[#3a6fff]";
    nomeSpan.addEventListener("click", () => openViewPage(index));
    nomeSpan.setAttribute("tabindex", "0");
    nomeSpan.setAttribute("aria-label", `Visualizar ${funcionario.nome}`);

    li.appendChild(nomeSpan);

    const actions = document.createElement("div");
    actions.className = "flex space-x-1";

    const editBtn = document.createElement("button");
    editBtn.setAttribute("aria-label", `Editar ${funcionario.nome}`);
    editBtn.className = "text-[#0a1e5e] bg-transparent border border-[#0a1e5e] rounded px-1.5 py-0.5 text-xs leading-none hover:bg-[#0a1e5e] hover:text-white transition-colors";
    editBtn.innerHTML = '<i class="fas fa-edit"></i>';
    editBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      openEditPage(index);
    });
    actions.appendChild(editBtn);

    const deleteBtn = document.createElement("button");
    deleteBtn.setAttribute("aria-label", `Excluir ${funcionario.nome}`);
    deleteBtn.className = "text-[#d90000] bg-transparent border border-[#d90000] rounded px-1.5 py-0.5 text-xs leading-none hover:bg-[#d90000] hover:text-white transition-colors";
    deleteBtn.innerHTML = '<i class="fas fa-times"></i>';
    deleteBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      openDeletePopup(index);
    });
    actions.appendChild(deleteBtn);

    li.appendChild(actions);
    funcionarioList.appendChild(li);
  });
}

    function populateCargoSelect() {
      cargos.forEach(cargo => {
        const option = document.createElement("option");
        option.value = cargo.nome;
        option.textContent = cargo.nome;
        funcionarioCargoSelect.appendChild(option);
      });
    }

    function openDeletePopup(index) {
      funcionarioToDeleteIndex = index;
      popup.classList.remove("hidden");
      overlay.classList.remove("hidden");
    }

    function closeDeletePopup() {
      funcionarioToDeleteIndex = null;
      popup.classList.add("hidden");
      overlay.classList.add("hidden");
    }

    function openAddPage() {
  mainContent.style.display = "none";
  addFuncionarioPage.style.display = "flex";
  document.getElementById("funcionario-view-image").style.display = "none";
  document.getElementById("campo-imagem").style.display = "block"; // 👈 reexibe campo imagem

  backToListBtn.style.display = "inline-flex";
  navButtons.style.display = "none";

  funcionarioNameInput.value = "";
  funcionarioMatriculaInput.value = "";
  funcionarioRgInput.value = "";
  funcionarioDataIngressoInput.value = "";
  funcionarioCargoSelect.value = "";
  funcionarioSalarioInput.value = "";
  document.getElementById("funcionario-image").value = ""; // limpa campo de upload

  saveFuncionarioBtn.style.display = "inline-block";
  addEditTitle.textContent = "Adicionar Funcionário";
  saveFuncionarioBtn.textContent = "SALVAR";
  funcionarioNameInput.focus();

  delete saveFuncionarioBtn.dataset.editIndex;
  delete saveFuncionarioBtn.dataset.viewIndex;

  addFuncionarioBtn.style.display = "none";
}


    function backToList() {
  addFuncionarioPage.style.display = "none";
  mainContent.style.display = "flex";
  backToListBtn.style.display = "none";
  navButtons.style.display = "flex";

  // Reativa os campos ao voltar da visualização
  [
    funcionarioNameInput,
    funcionarioMatriculaInput,
    funcionarioRgInput,
    funcionarioDataIngressoInput,
    funcionarioCargoSelect,
    funcionarioSalarioInput
  ].forEach(input => {
    input.disabled = false;
  });

  renderFuncionarios();
  addFuncionarioBtn.style.display = "flex";
}


   function openEditPage(index) {
  const funcionario = funcionarios[index];
  mainContent.style.display = "none";
  addFuncionarioPage.style.display = "flex";
  document.getElementById("funcionario-view-image").style.display = "none";
  document.getElementById("campo-imagem").style.display = "block"; // 👈 reexibe campo imagem

  backToListBtn.style.display = "inline-flex";
  navButtons.style.display = "none";

  funcionarioNameInput.value = funcionario.nome;
  funcionarioMatriculaInput.value = funcionario.matricula;
  funcionarioRgInput.value = funcionario.rg;
  funcionarioDataIngressoInput.value = funcionario.dataIngresso;
  funcionarioCargoSelect.value = funcionario.cargo;
  funcionarioSalarioInput.value = funcionario.salario;

  saveFuncionarioBtn.style.display = "inline-block";
  addEditTitle.textContent = "Editar Funcionário";
  saveFuncionarioBtn.textContent = "SALVAR";
  funcionarioNameInput.focus();

  saveFuncionarioBtn.dataset.editIndex = index;
  delete saveFuncionarioBtn.dataset.viewIndex;

  addFuncionarioBtn.style.display = "none";
}


    function openViewPage(index) {
  const funcionario = funcionarios[index];
  document.getElementById("funcionario-view-image").src = funcionario.imagem || "";
  document.getElementById("funcionario-view-image").style.display = "block";
  mainContent.style.display = "none";
  addFuncionarioPage.style.display = "flex";
  backToListBtn.style.display = "inline-flex";
  navButtons.style.display = "none";

  document.getElementById("campo-imagem").style.display = "none"; // 👈 oculta o campo de imagem

  funcionarioNameInput.value = funcionario.nome;
  funcionarioMatriculaInput.value = funcionario.matricula;
  funcionarioRgInput.value = funcionario.rg;
  funcionarioDataIngressoInput.value = funcionario.dataIngresso;
  funcionarioCargoSelect.value = funcionario.cargo;
  funcionarioSalarioInput.value = funcionario.salario;

  funcionarioNameInput.disabled = true;
  funcionarioMatriculaInput.disabled = true;
  funcionarioRgInput.disabled = true;
  funcionarioDataIngressoInput.disabled = true;
  funcionarioCargoSelect.disabled = true;
  funcionarioSalarioInput.disabled = true;

  saveFuncionarioBtn.style.display = "none";
  addEditTitle.textContent = "Visualizar Funcionário";
  saveFuncionarioBtn.removeAttribute("data-edit-index");
  saveFuncionarioBtn.dataset.viewIndex = index;
  addFuncionarioBtn.style.display = "none";
}


    addFuncionarioBtn.addEventListener("click", () => {
      openAddPage();
     

    });

    backToListBtn.addEventListener("click", () => {
      backToList();
    });

    backFromAddBtn.addEventListener("click", () => {
      backToList();
    });

    confirmDeleteBtn.addEventListener("click", () => {
      if (funcionarioToDeleteIndex !== null) {
        funcionarios.splice(funcionarioToDeleteIndex, 1);
        renderFuncionarios();
        closeDeletePopup();
      }
    });

    cancelDeleteBtn.addEventListener("click", () => {
      closeDeletePopup();
    });

    
  saveFuncionarioBtn.addEventListener("click", () => {
  const nome = funcionarioNameInput.value.trim();
  const matricula = funcionarioMatriculaInput.value.trim();
  const rg = funcionarioRgInput.value.trim();
  const dataIngresso = funcionarioDataIngressoInput.value.trim();
  const cargo = funcionarioCargoSelect.value;
  const salario = funcionarioSalarioInput.value.trim();
  const imagemInput = document.getElementById("funcionario-image");
  const imagemFile = imagemInput.files[0];

  if (!nome || !matricula || !rg || !dataIngresso || !cargo || !salario) {
    alert("Todos os campos devem ser preenchidos.");
    funcionarioNameInput.focus();
    return;
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    const imagemBase64 = e.target.result;
    const funcionarioData = { nome, matricula, rg, dataIngresso, cargo, salario, imagem: imagemBase64 };

    if (saveFuncionarioBtn.dataset.editIndex !== undefined) {
      const idx = Number(saveFuncionarioBtn.dataset.editIndex);
      funcionarios[idx] = funcionarioData;
      delete saveFuncionarioBtn.dataset.editIndex;
    } else {
      funcionarios.push(funcionarioData);
    }

    backToList();
  };

  if (imagemFile) {
    reader.readAsDataURL(imagemFile);
  } else {
    // Se não há nova imagem, usar imagem anterior (se estiver editando)
    const existingImage = saveFuncionarioBtn.dataset.editIndex !== undefined
      ? funcionarios[Number(saveFuncionarioBtn.dataset.editIndex)].imagem
      : "";
    const funcionarioData = { nome, matricula, rg, dataIngresso, cargo, salario, imagem: existingImage };

    if (saveFuncionarioBtn.dataset.editIndex !== undefined) {
      const idx = Number(saveFuncionarioBtn.dataset.editIndex);
      funcionarios[idx] = funcionarioData;
      delete saveFuncionarioBtn.dataset.editIndex;
    } else {
      funcionarios.push(funcionarioData);
    }

    backToList();
  }
});


    // Populate cargo select on initial render
    populateCargoSelect();
    // Initial render
    renderFuncionarios();

 
  </script>
  

</body>
</html>